#!/bin/bash

cd "`dirname $0`"
cd ..

dist="$1"
url_field=download_url

cmd="bin/metacpan release --level debug --detect_backpan"

curl -s "http://api.metacpan.org/v0/release/_search" \
  -d '{ "fields": ["download_url"], "filter": {"term": {"distribution": "'"$dist"'"}}, "size": 5000, "sort": ["date"] }' \
  | perl -lne 'print $1 if /"download_url"\s*:\s*"([^"]+)"/' \
  | xargs --no-run-if-empty -n 1 $cmd

$cmd --latest
